<!DOCTYPE html>
<html lang="en">
<!--
Copyright 2013 Robert Schroll

This file is part of Beru and is distributed under the terms of
the GPL. See the file COPYING for full details.
-->
<head>
<meta charset="utf-8" />
<meta name="viewport" content="initial-scale=1.0, user-scalable=no">

<script src=".monocle/scripts/monocore.js"></script>
<script src=".monocle/scripts/monoctrl.js"></script>
<script src=".bookdata.js"></script>
<script src=".messaging.js"></script>
<script>
function createReader(bookData) {
    // Make sure each book saves its place to different cookies
    Monocle.Controls.PlaceSaver.COOKIE_NAMESPACE +=
        bookData.getMetaData("title").toLowerCase().replace(/[^a-z0-9]/g, '') + ".";
    Monocle.Controls.PlaceSaver.COOKIE_EXPIRES_IN_DAYS = 365;
    var placeSaver = new Monocle.Controls.PlaceSaver("reader");
    var reader = Monocle.Reader("reader", bookData,
        { panels: Monocle.Panels.TwoPane, place: placeSaver.savedPlace() },
        function (reader) {
            var stencil = new Monocle.Controls.Stencil(reader);
            reader.addControl(stencil);
            reader.addControl(placeSaver);
        }
    );
    Messaging.registerHandler("NavigateChapter", function (src) {
        reader.skipToChapter(src);
    });
    Messaging.registerHandler("GotoLocus", function(locus) {
        reader.moveTo(locus);
    });

    reader.listen("monocle:link:external", function(event) {
        Messaging.sendMessage("ExternalLink", event.m.href.external);
    });
    reader.listen("monocle:jumping", function(event) {
        Messaging.sendMessage("Jumping", [reader.getPlace().getLocus(), event.m.locus]);
    });
    reader.listen("monocle:pagechange", function(event) {
        Messaging.sendMessage("ChapterSrc", reader.getPlace().chapterSrc());
    });
}

window.onload = function () {
    createReader(bookData);
}
</script>

<link rel="stylesheet" type="text/css" href=".monocle/styles/monocore.css" />
<link rel="stylesheet" type="text/css" href=".monocle/styles/monoctrl.css" />
<style type="text/css">
div#reader {
    position: absolute;
    left: 0;
    right: 0;
    top: 0;
    bottom: 0;
}
div.monelem_page {
    bottom: 0;
    right: 0;
}
</style>
</head>

<body>
<div id="reader"></div>
</body>
</html>
